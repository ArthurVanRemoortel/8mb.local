services:
  8mblocal:
    image: jms1717/8mblocal:latest
    container_name: 8mblocal
    ports:
      - "8001:8001"
    volumes:
      - ./uploads:/app/uploads
      - ./outputs:/app/outputs
      - ./.env:/app/.env  # optional custom settings
    environment:
      - REDIS_URL=redis://127.0.0.1:6379/0
      # Intel VAAPI/QSV: enable only on Linux hosts with Intel/AMD GPUs
      # - LIBVA_DRIVER_NAME=iHD
    # === Choose ONE of the following blocks ===
    # 1) NVIDIA (uncomment if you have NVIDIA GPU)
    # gpus: all
    # environment:
    #   - NVIDIA_VISIBLE_DEVICES=all
    #   - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: all
    #           capabilities: [gpu]

    # 2) Intel/AMD VAAPI on Linux (uncomment if you have Intel/AMD GPU on Linux)
    # devices:
    #   - "/dev/dri:/dev/dri"
    # environment:
    #   - LIBVA_DRIVER_NAME=iHD
    restart: unless-stopped
